<div class="box box-info">
	<div class="box-header with-border">
		<h3 class="box-title">General Information</h3>
	</div>
	<!-- /.box-header -->
	<!-- form start -->
	<form class="form-horizontal" id="appForm" th:object="${confObj}">
		<div class="box-body">

			<div class="form-group"
				th:class="${#fields.hasErrors('applicationType') || #fields.hasErrors('configuration') } ?  'form-group has-error' : 'form-group' ">
				<label for="applicationType" class="col-sm-2 control-label">Application
					Type</label>
				<div class="col-sm-10">

					<select id="applicationType" class="form-control"
						name="applicationType">
						<option disabled="true"
							th:selected="${confObj.applicationType == null} ? true : false"
							value="">-- select an option --</option>
						<option th:each="type:${applicationTypes}" th:text="${type}"
							th:selected="${confObj.applicationType == type} ? true : false"
							th:value="${type}">AppType</option>
					</select> <span th:each="error : ${#fields.errors('applicationType')}"
						th:text="${error}" class="help-block" /> <span
						th:each="error : ${#fields.errors('configuration')}"
						th:text="${error}" class="help-block" />
				</div>
			</div>

			<div class="form-group"
				th:class="${#fields.hasErrors('name')} ?  'form-group has-error' : 'form-group' ">
				<label for="name" class="col-sm-2 control-label">Application
					Name</label>
				<div class="col-sm-10">
					<input class="form-control" id="name" th:field="*{name}"
						placeholder="Application name" /> <span
						th:each="error : ${#fields.errors('name')}" th:text="${error}"
						class="help-block" />
				</div>
			</div>


			<div class="form-group"
				th:class="${#fields.hasErrors('title')} ?  'form-group has-error' : 'form-group' ">
				<label for="title" class="col-sm-2 control-label">Title</label>
				<div class="col-sm-10">
					<input class="form-control" id="title" th:field="*{title}"
						placeholder="Application title" /> <span
						th:each="error : ${#fields.errors('title')}" th:text="${error}"
						class="help-block" />
				</div>
			</div>

			<div class="form-group" th:if="${model.edit}"
				th:class="${#fields.hasErrors('users_read')} ?  'form-group has-error' : 'form-group' ">
				<label for="reads" class="col-sm-2 control-label">Access
					Control</label>
				<div class="col-sm-10">
					<h6>* Write access will overwrite the read access.</h6>
					<table class="table" id="access">
						<thead>
							<tr>
								<th class='text-center'>Operation</th>
								<th class='text-center'>User Name</th>
								<th class='text-center'>Users Right</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="user:${confObj.users_wirte}">
								<td class='text-center'>
									<button class='btn btn-danger btn-simple btn-xs access-rm-btn'>
										<i class='fa fa-times'></i>
									</button>
								</td>
								<td class='text-center' th:text='${user}'></td>
								<td class='text-center'>Write</td>
								<input type='hidden' name='writes' th:value='${user}' />
							</tr>
							<tr th:each="user:${confObj.users_read}">
								<td class='text-center'>
									<button class='btn btn-danger btn-simple btn-xs access-rm-btn'>
										<i class='fa fa-times'></i>
									</button>
								</td>
								<td class='text-center' th:text='${user}'></td>
								<td class='text-center'>Read</td>
								<input type='hidden' name='reads' th:value='${user}' />
							</tr>
						</tbody>
					</table>
					<span th:each="error : ${#fields.errors('users_read')}"
						th:text="${error}" class="help-block" />
					<div class="pull-right"
						style="padding-top: 16px; padding-left: 10px">
						<div class="input-group">
							<button class="btn btn-primary btn-simple btn-sm" id="access-btn"
								style='font-size: 12pt'>
								<i class="material-icons">add_box</i> Add
								<div class="ripple-container"></div>
							</button>
						</div>
					</div>
					<div class="col-md-3 pull-right">
						<div class="input-group">
							<span class="input-group-addon"> <i class="material-icons">keyboard_arrow_right
							</i>
							</span>
							<div class="form-group label-floating">
								<label class="control-label">Type</label> <select
									class="form-control" id='access-right'>
									<option value='Read' selected=''>Read</option>
									<option value='Write'>Write</option>
								</select> <span class="material-input"></span>
							</div>
						</div>
					</div>
					<div class="col-md-3 pull-right">
						<div class="input-group">
							<span class="input-group-addon"> <i class="material-icons">keyboard_arrow_right
							</i>
							</span>
							<div class="form-group label-floating">
								<label class="control-label">User name</label> <input
									type="text" class="form-control" id='access-username' /> <span
									class="material-input"></span>
							</div>
						</div>
					</div>
				</div>
			</div>


			<div class="form-group"
				th:class="${#fields.hasErrors('description')} ?  'form-group has-error' : 'form-group' ">
				<label for="description" class="col-sm-2 control-label">Description</label>
				<div class="col-sm-10">
					<textarea rows="6" class="form-control" id="description"
						th:field="*{description}" placeholder="Application description"></textarea>
					<span th:each="error : ${#fields.errors('description')}"
						th:text="${error}" class="help-block" />
				</div>
			</div>


			<div class="form-group"
				th:class="${#fields.hasErrors('isPrivate')} ?  'form-group has-error' : 'form-group' ">
				<div class="col-sm-offset-2 col-sm-10">
					<div class="checkbox">
						<label> <input type="checkbox" name="isPrivate"
							th:field="*{isPrivate}" /> Private Application
						</label> <span th:each="error : ${#fields.errors('isPrivate')}"
							th:text="${error}" class="help-block" />
					</div>
				</div>
			</div>

			<div th:if="${appConfForm != null}" id="sub-conf-div">
				<div class="box-header with-border">
					<h3 class="box-title">Application Settings</h3>
				</div>
				<div style="margin-top: 10px">
					<div th:replace="~{${appConfForm}}" th:with="confObj=(${confObj})"></div>
				</div>

			</div>
			<div class="form-group"
				th:class="${#fields.hasErrors('isPrivate')} ?  'form-group has-error' : 'form-group' ">
				<div class="col-sm-offset-2 col-sm-10">
					<button type="submit" id="btn_submit"
						class="btn btn-info pull-right" th:if="${model.edit}"
						th:text="Update">Create</button>
					<button type="submit" id="btn_submit"
						class="btn btn-info pull-right" th:if="${!model.edit}"
						th:text="Create">Create</button>
				</div>
			</div>

		</div>

		<!-- /.box-footer -->

		<script th:inline="javascript">
			/*<![CDATA[*/

			$(function() {

				if (/*[[${model.edit}]]*/false) {
					$("#applicationType").prop("disabled", true).off(
							'click').off('change')
					$("#btn_submit").click(function() {
						$("#sub-conf-div *").prop("disabled", false);
						$("#applicationType").prop("disabled", false);
						$('#appForm').attr('action', /*[[${#httpServletRequest.requestURI}]]*/
						).attr('method', 'post').submit();
					});
					$('.access-rm-btn').click(function() {
						$(this).closest('tr').remove();
					});
					$('#access-btn')
							.click(
									function() {
										var right = $('#access-right').val();
										var user = $('#access-username').val();
										if (!user || !right || user.length < 1)
											return false;
										$a = $('<button>')
												.addClass(
														'btn btn-danger btn-simple btn-xs')
												.append(
														$('<i>').addClass(
																'fa fa-times'));
										$row = $('<tr>');
										$row.append($('<td>').addClass(
												'd-actions text-center')
												.append($a));
										$row.append($('<td>').addClass(
												'text-center').text(user));
										$row.append($('<td>').addClass(
												'text-center').text(right));
										$('<input>')
												.attr(
														{
															type : 'hidden',
															name : right == 'Write' ? 'writes'
																	: 'reads',
															value : user
														}).appendTo($row);

										$('#access > tbody:last-child').append(
												$row);
										$a.click(function(e) {
											$(this).closest('tr').remove();
										})
										return false;
									});
				} else {
					$("#applicationType").change(
							function() {
								$('#appForm').attr('action', "").attr('method',
										'get').submit();
							});
					$("#btn_submit").click(
							function() {
								$('#appForm').attr('action', "/createApp")
										.attr('method', 'post').submit();
							});

				}

			})

			/*]]>*/
		</script>
	</form>
</div>
